<h1><%= @driver.name %> (DID: <%= @driver.id %>)</h1>

<%# Calculate total earnings/ratings %>

<% total_earnings, total_ratings = 0, 0 %>
<% @driver.trips.each do |trip|  %>
  <% if !trip.is_archive %>
    <% total_earnings += [(trip.cost - 1.65) * 0.8, 0].max %>
    <% total_ratings += trip.rating %>
  <% end %>
<% end %>

<h1>Driver Info:</h1>
<div>
  Name: <%= @driver.name %> <br>
  VIN: <%= @driver.vin %> <br>
  Status: <%= !@driver.is_active ? "DEACTIVATED" : @driver.available ? "AVAILABLE" : "UNAVAILABLE" %> <br>
  Total Earnings: $<%= total_earnings %> <br>
  Average Rating: <%= (total_ratings.to_f / @driver.trips.length).round(2)  %>
</div>

<div>
  <%= button_to "#{@driver.is_active ? "ACTIVE" : "INACTIVE"}", driver_active_path(@driver.id, {source_call: "show"}), method: :patch %>
</div>

<br>

<% if @driver.is_active %>
  <%= link_to "Edit Driver Info", edit_driver_path %>
<% end %>

<div>
  <ul>
    <% @driver.trips.each do |trip|  %>
      <% if !trip.is_archive %>
        <li>
          Trip ID: <%= link_to trip.id, trip_path(trip.id) %> <br> 
          Date: <%= trip.date %> <br>
          Rating: <%= trip.rating %> <br>
          Cost: $<%= trip.cost %> <br>
          Passenger: <%= link_to "#{trip.passenger.name} (PID: #{trip.passenger_id})", passenger_path(trip.passenger_id) %> <br>
        </li>
      <% end %>
    <% end %>
  </ul>
</div>

<% if @driver.is_active %>
  <%= link_to "Edit Driver Info", edit_driver_path %>
<% end %>